#+title: Using Emacs Writing Studio
#+bibliography: ../library/emacs-writing-studio.bib
#+startup:      content
:NOTES:
- [X] Minimalist interface
  - [X] Modus Themes
  - [X] Fonts
- [X] Minibuffer completion
- [X] Which-Key
- [-] Workflow example: [cite:@travis_1995, p. 29]
:END:

The previous chapter described how to use and configure vanilla Emacs to make it behave as you want. The {{{ews}}} (EWS) configuration converts vanilla Emacs to a bespoke tool for authors. This chapter explains how to use the additional functionality that the /Emacs Writing Studio/ configuration provides and introduces a workflow from ideation to publication.

EWS uses a minimalist interface without any typical graphical software elements. This austere look minimises distractions from your screen so you can focus on what's important—writing words into a buffer. The second major change to vanilla Emacs is the completion system. /Emacs Writing Studio/ uses the Vertico / Orderless and Marginalia packages to provide enhanced completion in the minibuffer, making it easier to find functions, files, and other stuff you need.

The EWS configuration is an opinionated set of choices that might not suit everybody. Within the Emacs world, there is occasionally some discussion about what constitutes a sensible default configuration. No matter how interesting these debates can be, such a state does not exist. One person's sensible default is another person's computing nightmare, so feel free to change anything in EWS to suit your ideal worldview. The Appendix contains the complete annotated configuration and suggestions for making changes.

* Installing /Emacs Writing Studio/
You don't have to learn to program in Elisp to use Emacs. You can start with the /Emacs Writing Studio/ configuration to get you going. The next step is to install EWS and start using it. The remainder of the book does not explain any methods to configure Emacs but explains how to use the functionality in EWS to research, write and publish articles, books and websites. The Appendix to this book provides a detailed explanation of the EWS configuration.

To install the EWS configuration, download the =init.el= and =ews.el= files from the GitHub repository (=github.com/pprevos/emacs-writing-studio=) and save them in the configuration folder. The location of the configuration folder depends on your operating system and Emacs version. Type =C-h v user-emacs-directory= to identify its location in the popup help buffer. You can close this buffer by pressing =q=. Copy the files from the EWS repository to this directory. EWS will activate after you evaluate the ~restart-emacs~ function or the next time you start the program.

If you an experienced Emacs user, then you can try the EWS configuration by creating a separate folder for the init file and start Emacs with =emacs --init-directory <folder-path>=. That way you can try EWS without clobbering your existing configuration.

The EWS configuration also installs a package from GitHub with some bespoke variables and additional functionality. All such variables and functions start with ~ews-~. You will need to configure these variables to prevent errors as you work through this book.

Emacs can also integrate with various other free software to extend its functionality. Some of the features provided by EWS require you to install additional software that Emacs will control. You don't need to know how these packages work as Emacs will control them for you. Each chapter in this book outlines which software is neccesary for which purpose.

The ~ews-missing-executables~ function checks if external software is available on your system. Emacs writes a message in the minibuffer if any of the recommended tools is missing. You can jump to the =*Messages*= buffer with =C-h e= to review the output. Emacs will function normally when if any of the listed software is missing, but some features will be unavailable. The relevant chapters in this book provide more details the required software and the tasks it undertakes.

This book was written and published with the configuration it describes, so it is fully tested to real-life conditions. The GitHub repository for EWS also contains the =documents= folder which contains the Org mode files for this book. You can download these files as an example of a book researched, written and published with Emacs.

* Minimalist Interface
Emacs is a place of rest and contemplation away from the cacophony of contemporary software filled with buttons and functionality you don't need. The default Emacs user interface is a hybrid between keyboard and mouse-driven operations. While using the mouse might seem convenient, a keyboard-driven system is more efficient because you don't have to move your hand that much and switch contexts when finding icons.

The EWS configuration removes the toolbar, menu bar and scroll bars. While drop-down menus are a valuable tool to discover functionality, there is no need to constantly keep them on the screen. You can access the menu with =F10= (~menu-bar-open~) and select menu options with the arrow keys and =RET= to choose an item. You exit the menu with =C-g= (~keyboard-quit~). But after using Emacs for a while, you'll quickly build muscle memory and revert to keyboard shortcuts. Note that the menu items show the relevant keyboard shortcuts when available.

This configuration also installs the Spacious Padding package by Protesilaos (Prot) Stavrou, which increases the margins around the text so the screen is not too cramped with symbols.

** Themes
A theme is a set of instructions that describe the colours of defined text parts. Colours in a text processor play a different role than in a word processor. Colours in Emacs are semantic, which means that they indicate the function of the text, not how it looks when published. A heading might have a different colour than the text or metadata, which helps you find your way through the document.

Two basic classes of themes exist for text processors: light and dark. Light backgrounds, common with most modern word processing software, can cause asthenopia (eye strain) after you stare at the screen for a while. Dark colour schemes increase visual acuity and reduce visual fatigue, especially in low-light physical environments with complex backgrounds [cite:@kim_2019_dark]. Many text processor users prefer dark themes. Light themes are not bad intrinsically as they are effective when you work in a brightly lit room.

The EWS configuration installs and activates the most recent version of Prot's Modus themes. The Modus themes have two primary versions: the =modus-operandi= theme is the primary light theme, while the =modus-vivendi= theme is its dark counterpart. The primary Modus themes maximise contrast between background and foreground following the Web Content Accessibility Guidelines (WCAG). The Modus themes comply with the triple-A standard of the WCAG, which specifies a minimum contrast ratio between background and foreground of 7:1. This high contrast ratio is legible for people with moderately low vision. Each of the primary themes has three modified versions: two versions for red-green and blue-yellow colour blindness (deuteranopia and tritanopia) and a more colourful variety (tinted).

/Emacs Writing Studio/ uses the tinted versions as default. These versions have a slightly lower contrast ratio and are suitable for people with normal vision. The Modus themes do not prescribe keyboard shortcuts, so EWS defines some. The =C-c w t t= shortcut toggles between the light and dark side (insert Star Wars pun here). Using =C-c w t s= provides a selection menu of all Modus themes. /Emacs Writing Studio/ uses =C-c w= as its default prefix key for its specific functionality, where the =w= is a mnemonic for writing and =t= for theme.

The Modus Themes package includes an extensive manual that explains in detail how to customise the look and feel of its collection of themes. This manual is available through Info Mode with =C-h R modus=. The Appendix provides some more information on how to customise the theme for your personal settings.

Emacs users have developed a ragtag collection of themes. To pick your favourite, you can browse the Emacs Themes Gallery (=emacsthemes.com=). If the theme is available in the ELPA or MELPA package repositories, you can install it as explained in the Appendix.

** Setting Fonts
The default font in Emacs is a fixed-pitch (mono-spaced) font designed for writing code. In a fixed-pitch font, all characters have the same width. An =i= or an =w= will use the same amount of space, just like mechanical typewriters. This type of letter is ideal when writing code or tables because it helps to align the text.

- =Fixed pitch font=
- Variable pitch font

A variable-pitch font is easier on the eye when writing prose. Not all characters have the same width in a variable-pitch font, as is common in natural writing. Ideally, we want the best of both worlds and configure Emacs to use the most suitable font for each situation. Emacs can define a different font for certain parts of the text, for individual buffers, or for a major mode. The EWS configuration uses variable pitch mode for the ideal mix between font types.

The /Emacs Writing Studio/ configuration does not specify any particular fonts and uses your system's defaults. You can configure your favourite fonts, provided they are available on your computer. You need to define three font variables:

- =default=: The default settings (a fixed-pitch font).
- =fixed-pitch=: The font used for computer code.
- =variable-pitch=: The settings for prose.

In Emacs lingo, a 'face' is a collection of attributes to display text. It defines the font, foreground colour, background colour, optional underlining, etc. Various face attributes are available for configuration. The main ones to use are:

- =font=: The name of the font
- =height=: The font height as an integer in units of 1/10 point.

You can use the customisation menu by evoking ~customize-face~ and selecting =default=, =fixed-pitch= or =variable-pitch= and entering the font name in the /Font Family/ box. Click /Apply and Save/ for each font. This action saves the font settings to the =custom.el= file, which Emacs evaluates at the beginning of the startup sequence. Please note that anything you customise this way overrides any theme settings, so ideally, only customise font family and size.

To see which fonts are available, you use the graphical window by running ~menu-set-font~. When you use the GUI to set the default font, the change is immediate but transient. Use ~menu-bar-options-save~ to save your default font and size to the =custom.el= file.

* Minibuffer Completion
Even with the advent of speech-to-text software, the keyboard is still the most common method to convert thoughts to text. While computers might one day even read our minds, there is something to be said about using your fingers to do the talking. Who would want their 'ums' and 'ahs' or their uncensored stream of consciousness committed to text? Writing is as much about thinking and crafting a stream of words as it is about maximising keystrokes per minute.

Completion systems are like predictive text on a mobile phone. You start typing some characters, and the computer lets you complete your choice. Emacs has an extendable completion system that helps you complete long words, find files, remember function names and other menial tasks. This article explains the basic minibuffer completion engine and introduces some packages extending this functionality. Emacs has three types of completion systems:

1. /Minibuffer completion/ assists with picking choices in the minibuffer, such as function names and files.
2. /Keychord completion/: Systems to help with keyboard shortcuts.
3. /Text completion/ helps you complete words you type in the buffer (see Chapter [[#chap-production]]).

The minibuffer is where you find files, evaluate functions, and enter other information. The minibuffer completion system aims to make it easier to find what you need by providing a search mechanism that provides a list of possible options. The standard minibuffer Emacs completion system focuses on entering functions, filenames, buffer names and any other selection process in the minibuffer.

The minibuffer completion system is highly configurable, and several packages extend the vanilla functionality. The EWS configuration uses a stack of connected packages developed by Daniel Mender to provide a seamless experience.

The Vertico package uses incremental search, meaning the list of candidates is shortened to match your entry as soon as you type one or more characters. For example, when opening a file with =C-c C-f=, you can start typing any part of the filename to locate the file you seek. Use =C-backspace= keys to move to a higher directory.

The Savehist package remembers your selections and saves your minibuffer history when exiting Emacs. This package ensures that your most popular choices remain on top for further convenience. To further refine our ability to find completion candidates, the Orderless package enhances Vertico and matches patterns, irrespective of the order in which they are typed. For example, typing =emacs writing TAB= provides the same results as =writing emacs TAB=. 

Emacs is a self-documenting computing environment, meaning every function and variable includes a text describing what it does. The Marginalia package displays the first line of these texts next to your completion candidates. This package also shows available keyboard shortcuts for relevant completion candidates (Figure [[fig:vertico]]). When you type =M-x=, you will see a list of functions and a brief description of what they do and whether there is a keyboard shortcut to access it.

#+caption: Minibuffer completion with Vertico, Orderless and Marginalia.
#+name: fig:vertico
#+attr_html: :alt Minibuffer completion with Vertico, Orderless and Marginalia :title Minibuffer completion with Vertico, Orderless and Marginalia
#+attr_latex: :width \textwidth
[[file:images/mini-buffer-completion.jpg]]

** Keyboard Shortcuts
Completion shortens the amount of text you must type and is ideal for discovering functionality you did not yet realise existed. However, as explained in the previous chapter, we usually don’t type function names but use keyboard shortcuts.

Remembering which keyboard shortcut you need takes some effort. The Which-Key package by Justin Burkett is not so much a completion system but a great help when trying to remember which keyboard shortcut to use. This package provides a minor mode that displays the keybindings following the currently entered incomplete command (a prefix) in a popup.

Many keyboard shortcuts have multiple parts, such as =C-x C-f=. The which-key package shows a popup menu that lists all the available options. When, for example, you press =C-x=, the menu will list all follow-up keys and the function they are bound to. Where it says =prefix= in the popup, this means that there is a deeper level. So, by pressing =C-c w=, the EWS prefix, you see a list of the available sub-menus and functions.

If the shortcuts are too large to fit in the popup window, you can move to the next page with =C-h n= and the previous page with =C-h p=. Just typing =C-h= inside the Which-Key popup displays additional options to navigate the list of key bindings.

#+caption: Which-Key popup window for C-c-w (Emacs Writing Studio).
#+attr_html: :alt Which-Key popup window for Emacs Writing Studio :title Which-Key popup window for Emacs Writing Studio :width 600
[[file:images/which-key-popup-screen.jpg]]

* Introducing Org Mode
:PROPERTIES:
:CUSTOM_ID: sec:org-mode
:END:
The previous chapter explained how to write a plain text file. Now, we add a new layer of complexity by introducing Org mode, a powerful major mode that comes with Emacs by default. This software was initially developed in 2003 by Carsten Dominik, professor of astronomy at the University of Amsterdam. Since then, countless other developers have continued to advance Org mode. Many people use Emacs because of Org mode is a perfect environment for writing. 

You can use Org mode to publish websites, articles and books, keep a diary, write research notes, manage your actions, and more. And on top of all that, it is intuitive to use. This section shows you the basics of writing prose in Org mode. The remainder of the book explains the more specialised functionality of this extensive package.

Start by creating a file with a =.org= extension and start writing, for example, =C-x C-f test.org=. Emacs automatically enables Org mode for any file with the =.org= extension. Org mode is derived from text mode, so everything explained in [[#sec:text-mode]] also applies to this section. 

Each Org document starts with a header that contains metadata and settings relevant to the buffer. The Org mode metadata and settings start with =#+= followed by a keyword and a colon, and the metadata, for example, =#+title: Romeo and Juliet=. The document header can also contain metadata such as a subtitle or a date and other bits of information. Emacs packages can use this information when publishing the text and other functionality. If Shakespeare had used Org mode, the front matter could be:

#+begin_example
  #+title:   Romeo and Juliet
  #+author:  William Shakespeare
  #+date:    [1597-05-08 Thu]
#+end_example

This section only provides a short introduction to using Org mode to write prose. Subsequent chapters explain more specialised functionality in Org mode, such as managing projects and exporting. The extensive Org mode manual is available in the info system with =C-h R org=.

** Document Structure
:PROPERTIES:
:CUSTOM_ID: sec:org-structure
:END:
One of the unofficial rules of writing is to define the structure before writing the content. Books have chapters, sections and paragraphs; articles have headings; poems have verses; and so on. Almost all forms of writing have a hierarchy. Org mode has a flexible set of commands to quickly define the structure of your writing project. Defining headings is as easy as starting a line with an asterisk followed by a space. To create deeper levels, add more stars:

#+begin_example
  * Heading 1
  ** Heading 2
  *** Heading 3
#+end_example

When you press =M-RET=, the following line becomes a new heading. With =C-RET=, the new line is added after the text in the current section. You can also promote a standard paragraph to a heading using =C-c *= (~org-toggle-heading~). Org mode also makes it easy to move and promote or demote existing headings and associated subheadings and text (which in Org mode is a subtree). Just use the =ALT= and arrow keys to move a subtree around the document. You can also use these keys to move paragraphs.

When the cursor is on a heading the =TAB= key collapses the text. Repeatedly pressing =TAB= shows the subheadings and then again the full text. To collapse the whole document, add the Shift key. Pressing =S-TAB= collapses the whole buffer, showing only the level one headings. Pressing =S-TAB= once again will show headings, and repeating it for a second time reveals all text. You can keep cycling through these modes with the =S-TAB= key (figure [[#fig:org-cycle]] and table [[#tab:org-structure]]). You can recognise folded headings by the ellipses (=…=) at the end of the line. The Org-Modern package (section [[#sec:rice]]) also changes the asterisks to triangles. When the triangle points to the right, the heading is collapsed and when it points down, the heading is open.

#+begin_src dot :file images/org-cycle.png
  digraph {
      graph [dpi=300]
      rankdir=LR
      node [shape="box"]
      node [fontname=Arial fontsize=10];
      edge [fontname=Courier fontsize=9 color=gray]
      "Show All" -> Contents -> Overview -> "Show All"
  }
#+end_src
#+caption: Global cycling in Org mode with =S-TAB=.
#+name: fig:org-cycle
#+attr_latex: :width 0.5\textwidth
#+attr_org: :width 300
#+RESULTS:
[[file:images/org-cycle.png]]

Org mode also provides a set of commands to make it easier to jump between headings. These commands let you move between headings of the same level and move up in the hierarchy. Table [[#tab:org-structure]] lists some the available commands related to the structure of Org mode documents.

#+caption: Org mode structure editing.
#+name: tab:org-structure
| Shortcut             | Function                        | Description                     |
|----------------------+---------------------------------+---------------------------------|
| =C-c *=                | ~org-toggle-heading~              | Convert paragraph to heading    |
| =TAB= / =S-TAB=          | ~org-cycle~                       | (Un)fold headings               |
| =M-<up>= / =M-<down>=    | ~org-metaup~ / ~org-metadown~       | Move a heading or paragraph     |
| =M-<left>= / =M-<right>= | ~org-metaleft~ / ~org-metaright~    | Promote or demote a heading     |
| =M-RET=                | ~org-meta-return~                 | Insert a new heading            |
| =C-c *=                | ~org-toggle-heading~              | Convert paragraph or vice versa |
| =C-C C-n=              | ~org-next-visible-heading~        | Move to next heading            |
| =C-c C-p=              | ~org-previous-visible-heading~    | Move to previous heading        |
| =C-c C-u=              | ~outline-heading-up~              | Move to the higher level        |
| =C-c C-f=              | ~org-forward-heading-same-level~  | Move next at the same level     |
| =C-c C-b=              | ~org-backward-heading-same-level~ | Move previous at the same level |

** Text Formatting
Writing all words in the same style can be boring and some text needs some emphasis. To change how Org Mode displays text, you surround it with special characters: =/italic/=, =*bold*=, =_underline_=, =+strikethrough+= and ==verbatim==. In Vanilla Emacs, these markers remain visible but disappear when exporting the document to its published format.

The EWS configuration hides these markers. The only problem with hiding emphasis markers that way is that rich text becomes hard to edit because it is unclear whether your cursor is on the marker or the first or last character. EWS therefore uses the Org-Appear package by Alice Hacker. This tool displays the rich text markers while the cursor is on a word but hides them otherwise, resulting in a less cluttered screen.

** Lists
Writing lots of prose in long paragraphs can make content hard to understand, so non-fiction authors use lists to create clarity in writing. Writing lists in Org mode could not be easier. Start a line with a dash and complete the entry with =M-RET= to create the next entry. Using the Alt and left or right arrow keys changes the depth of the item. The Alt key with the up and down arrows moves the line up or down in the hierarchy. You can change the list prefix with the =SHIFT= and left/right arrow keys. The default options are:  =-=, =+=, =1.= or =1)=. You can convert a paragraph to a list with =C-c -= (~org-toggle-item~). Repeatedly using this command changes the bullet type, just like shift and the arrow keys. To demote a list item back to a paragraph, simply remove the list characters.

#+begin_example
  - Item
    + next item
      1. The following
      2. And another
         a. Down, down, deeper and down
#+end_example

Numbered lists start at one by default but you can add a cookie to start the list at a different number. For example, to start the list at number 3, add =[@3]=, as shown below.

#+begin_example
3. [@3] First line
4. Second line
#+end_example

Org mode can also order your list with the ~org-sort~ function (=C-c ^=). You will be prompted to select a sorting method, which can be either numerically, alphabetically or more advanced options.
     
** Tables
:NOTES:
- [X] https://orgmode.org/worg/org-tutorials/tables.html
:END:

A table is another mechanism in technical publications to structure information in lieu of prose. Creating tables in Org mode uses an intuitive plain method to add, remove and move columns and rows. To create a table, start a line with a pipe (=|=) symbol, enter the content, and continue until you have defined all columns. Then, end the line with another pipe. Every cell in an Org mode table is flanked by a pipe. You don't have to worry about aligning the text because the =TAB= or =C-c C-c= automatically add spaces to adjust the column sizes.

Navigate forward through the cells with the =TAB= or arrow up/down keys. Using =S-TAB= moves the cursor back one cell. Combining Alt and Shift with the arrow keys adds and removes columns and rows. When you start a row with =|-= and hit =TAB=, you create a horizontal line across the table. You can also add a horizontal line below the cursor and move to the next row with =C-c RET=, which in this context calls the ~org-table-hline-and-move~ function.

#+begin_example
,#+caption: Example table.
,#+name: tab:example
| Column 1 | Column 2 |
|----------+----------|
| Sator    |       12 |
| Arepo    |       26 |
| Tenet    |      878 |
| Opera    |       89 |
| Rotas    |       89 |
#+end_example

Each table can also have a caption, which starts with the =#+caption:= token and a name (=#+name:=). These lines are mainly used for creating cross-references when publishing your document, which is further explained in Chapter [[#chap:publication]].

Org mode can only handle simple tables without spanning columns or rows. To create more complex tables, Org mode integrates with the builtin table package by Takaaki Ota. These tables have a slightly different syntax to Org mode, as illustrated below in this table of German articles. Note that Org mode syntax inside cells in these types of tables is not recognised. Because of interference with other Org mode functionality, Takaaki Ota tables cannot be edited directly in an Org buffer. To edit such a table use ~org-edit-special~ (=C-c '=). To convert a standard Org mode table to the more complex format use ~org-table-create-with-table.el~, bound to =C-c ~=. To learn more about the syntax for this package, read the manual with =C-h P table=.

#+begin_example
+------------+-----------+----------+----------+-------------+
|            |             Singular            | Plural      |
|            +-----------+----------+----------+-------------+
|            | Masculine | Neuter   | Feminine | All genders |
+------------+-----------+----------+----------+-------------+
| Nominative | der       | das      | die      | die         |
| Accusative | den       | das      | die      | die         |
| Dative     | dem       | dem      | der      | denen       |
| Genitive   | dessen    | dessen   | deren    | deren       |
+------------+-----------+----------+----------+-------------+
#+end_example

** Links
:PROPERTIES:
:CUSTOM_ID: sec:links
:END:
A text, just like a person, neither can exist in solitude. A as people we have family and friends and so do texts. You might need links to connect related files (friends) or reference text from which your writing borrows ideas (parents). Relationships between electronic texts are established with hyperlinks. Org mode recognises a large suite of link types, such as websites, Document Object Identifiers (DOI) and internal files.

Links in Org mode start with an identifier, followed by the link itself. For example, websites start with the usual =https:= and files start with =file:= and DOI numbers, you guessed it, start with =doi:=. Org mode recognises these automatically as you type them, for example adding =doi:10.1201k/9781003326977= creates a clickable link.

When the link location contains spaces you need to surround it with a double square brackets for it to become active: =[[file:file-name]]=. Links can also contain a description using the following syntax: =[[type:link][description]]=. When a link has a description, Org mode hides the syntax and formats it like hyperlink on a website. You can switch this behaviour on and off with ~org-toggle-link-display~.

You follow a link in Org mode with a mouse click or by pressing =C-c C-o= (~org-open-at-point~) with your cursor on the link text. If you use this shortcut anywhere in the text that is not a link, Org mode presents a list of links in the current heading.

You don't have to type the square brackets and create and edit links with =C-c C-l= (~org-insert-link~). This function first asks you to select the link type and then for the full link address. The last step asks for an optional description. To remove a link and only keep the description as plain text, use this command and erase the link address, keeping or modifying the description.

To create a link to a website, copy the URL from the browser and use the ~org-web-tools-insert-link-for-url~ function (=C-c w w=) which creates a fully-formatted link from the URL in the kill ring and fetches the description from the website.

Org mode can also insert references to literature, which is covered in chapters [[#chap:inspiration]] and [[#chap:production]].

** Images
:PROPERTIES:
:CUSTOM_ID: sec:images
:END:
Although Emacs is a text processor, it can also display images. In Org mode, an image is a link to an image file, so the text and the images remain separate files. To add an image, press =C-c C-l= (~org-insert-link~), which opens the link menu. Org mode understands many types of links and for images we need a file link, so type =file:=. Press enter and select the image filename in the minibuffer. You can skip the =file= part by adding the universal argument with the =C-u C-c C-l= shortcut, from where you can start selecting the image file. Your buffer will now contain a link that starts with =file:=, the directory and file name. Under the hood, Org mode wraps the link between double square brackets, so it looks like: =[[file:path/to/image]]=. 

#+begin_example
  #+caption: Image caption.
  #+name: fig:example
  #+attr_org: :width 600
  [[file:path/to-image]]
#+end_example

Links to files can be absolute or relative to the directory the document you are linking from is in.



After adding the link, you can preview the image with the ~org-redisplay-inline-images~ function or =C-c C-x C-M-v=. To toggle previewing pictures in the whole document, use =C-c C-x C-v= (~org-toggle-inline-images~).

The EWS configuration enables default image previews in all Org mode buffers, but adding a new image removes the preview so you run the redisplay command. The pictures in the buffer are all shown at 300 pixels wide. You can configure the preview size to your preference by adding a line above the image, for example: =#+attr_org:: width 600=. 

Emacs has some facilities to manage image libraries through the Image-Dired package, discussed in Chapter [[#chap:admin]].

Image links are links to other files without a description. 

Like tables, you can add a caption and a reference name to an image. Various other attributes can be added to define how the image is displayed in the published version, as explained in Chapter [[#chap:publication]].

** Mathematical Notation
:PROPERTIES:
:CUSTOM_ID: sec:formulas
:END:
Technical authors often rely on mathematical notation, which in Org mode is written in LaTeX syntax. You can use simple LaTeX commands in your text, known as pretty entities, or write fully-formatted mathematical notation.

Pretty entities (more precisely UTF-8 characters) in Org mode relate to special symbols, such as superscript and subscript (=x^{2}= or =x_{2}=) and other characters, such as =\pi=, which display as x², x₂ and π. Org mode also understands other LaTeX characters, such as Greek letters (=\alpha= to =\omega=), superscripts and subscripts. You can write these plainly inside an Org buffer. EWS converts these to their 'pretty' version by default. The underlying text remains the same. You can switch this behaviour on and off with the =C-c C-x \= keys (~org-toggle-pretty-entities~). By default, Org mode does not require curly braces for sub- and superscripts. But this can cause confusion if you like to write something using 'snake_case'. The EWS configuration limits applying sub- and superscripts to characters between curly braces.

For more complex formulas you need to use the full LaTeX formula notation. A formula is surrounded by one or two dollar signs. A single dollar sign indicates an inline formula, while using double dollar signs displays the formula as a separate paragraph with larger symbols.

To give you a taste of what LaTeX formulas look like, this is Ramanujan's formula for \pi, both graphically and in LaTeX notation. A full explanation of LaTeX formula notation is outside the scope of this book. You can reverse-engineer this example as it contains what you need for 80% of mathematical formulas. 

$$\frac{1}{\pi} = \frac{\sqrt{8}}{9801} \sum_{n=0}^{\infty}\frac{(4n)!}{(n!)^4}\times\frac
{26390n + 1103}{396^{4n}}$$

#+begin_example
$$\frac{1}{\pi} = \frac{\sqrt{8}}{9801}
\sum_{n=0}^{\infty} \frac{(4n)!}{(n!)^4} \times
\frac{26390n + 1103}{396^{4n}}$$
#+end_example

If the pretty entities functionality is enabled, then some LaTeX symbols are converted to mathematical notation, so you might want to disable this when writing mathematical expressions with =C-c C-x \=.

Org mode can preview LaTeX fragments as images if the =dvipng= program is available. To preview the fragment under the cursor, press =C-c C-x C-l= (~org-latex-preview~). This process converts LaTeX formulas to an SVG file stored in a subdirectory named =ltximg=. 

The Org-Fragtog package by Benjamin Levy provides convenient functionality to toggle between the plain text LaTeX fragments and the image preview. When the cursor is inside a formula, Emacs shows the plain text, and when outside a formula, it shows the graphical version, preventing the need for manual switching.

** Ricing Org Mode
:PROPERTIES:
:CUSTOM_ID: sec:rice
:END:
Ricing is slang term among software developers referring to heavily customising the appearance of their editor. This prettification could involve themes, fonts, and other visual tweaks to create a unique style. Vanilla Emacs is an ugly duckling that can be configured into a beautiful swan. The EWS configuration file contains some modifications to the user interface.

The main difference between a plain text processor and a WYSIWYG word processor is that in Emacs the design of the text (font, colour and so on) communicates meaning rather than design. Your Emacs theme sets the colours and perhaps also fonts for your document. The purpose of this styling is to help you navigate the document. The way your document looks in the buffer is not what it looks like when exported to the final product.

The active theme and various configurations and packages define the display of an Org mode buffer. Emacs defines how a buffer looks through =font-lock-mode=. Font locking assigns faces to (or 'fontifies' in Emacs speak) various parts of your text using logical rules. Evaluating =font-lock-mode= toggles between the fully configured version of your Org mode file and the plain text version. Run this function on an existing Org mode file to see the difference between pure plain text and a fontified text. To take it a step further, you can open an Org mode file and run ~text-mode~ to disable all Org mode functionality and see the file in its raw beauty. To jump back to safety, simply run ~org-mode~ to restore the file.

EWS uses parts of the Org-Modern package *********

* Checking Spelling
Writing with a spellchecker has become the ultimate security blanket for authors. Without the squiggly red lined underneath our text, the final product would be littered with typos, at least in my case. The Emacs ispell package Flyspell minor mode provide an interface to the Hunspell spell-checking software, so you must ensure that it is available on your computer, including at least one dictionary. The EWS configuration enables the Flyspell minor mode (spelling on-the-fly) for all text modes.

There are basically two ways to correct your writing. Either just keep the juices flowing and check the complete text when your complete the session, or fix typos as detected.

The ~ispell~ function (=C-c w s s=) walks through possible spelling mistakes in the buffer or in a selected region. This function displays the proposed corrections at the top of the window. You can select the preferred version by entering the relevant number. The minibuffer provides a menu to ignore the typo with the space bar, accept it for this session (=a=), insert in your personal dictionary with =i= and other options which =C-h= reveals. Any key not in the menu quits the spellchecking session.

To fix typos on the fly use the ~flyspell-auto-correct-previous-word~ (=C-;=) function. This function replaces the first detected spelling error before the cursor visible on the screen with the most likely correction. This function prevents you from having to jump to your spelling mistakes and back to where you came from. Repeatedly pressing =C-;= cycles through the available options until you return to the original version. The echo area shows the list of possible corrections. Typing any other key breaks the chain. All changes are also stored in the undo system, so you can still go back to an earlier option if you accidentally go to far. 

Flyspell has a handy command to jump between suspected spelling errors. The ~flyspell-goto-next-error~ function (=C-,=) places the cursor at the next word that need a review. Add thing the universal argument (=C-c C-,)= jumps to the previous possible error. To store the supposedly mistyped word in your personal dictionary, move to the word and use ~ispell-word~ (=M-$=) and use the options in the menu.

The Hunspell software has access to a wide collection of dictionaries, including variations of English, which you have to install separately. The default dictionary for EWS is Australian English. Customise the ~ispell-dictionary~ variable to change the default language. If you are multilingual, then you can add multiple dictionaries in the variable, separated by a comma, for example ="en_AU,nederlands=", which are my preferred languages. Any changes to dictionaries will only have effect when the chosen dictionary is available on your system. Download the dictionaries of the language(s) you write and configure ispell to help you write correct syntax.

* The {{{ews}}} Workflow
The process of writing can be chaotic as it involves successive iterative cycles. But an orderly pattern emerges when we stand back from details of the daily grind. We read literature and get inspired, develop new ideas, produce new works and publish the results. Even though reality is never as linear as this list suggests, it is a helpful guide to organise the {{{ews}}} workflow and the content of the rest of this book (Figure [[fig:workflow]]).

#+begin_src dot :file images/emacs-workflow.png
  digraph {
      rankdir=LR
      fontname=Arial
      compound=true
      graph [dpi=300 nodesep=.5 ranksep=0.7]
      node [fontsize=10 fontname=Arial]
      edge [color=gray]

      subgraph inspiration {
          cluster=true
          rank=same
          label="Inspiration"
          penwidth=0.5
          lit [label="Other media" shape="rect" width=1]
          blogs [label="Internet" shape="rect" width=1]
          other [label="Literature" shape="rect" width=1]
      }

       subgraph ideation {
          cluster=true
          rank="same"
          label="Ideation"
          penwidth=0.5
          notes [label="Denote\nnotes" shape="folder" width=1]
          biblio [label="BibTeX\nbibliography" shape="folder" width=1]
      }

      subgraph manage {
          cluster=true
          label="Managing"
          penwidth=0.5
          tasks [label="Org Mode\nTodo" shape="folder" width=1]	
      }

      subgraph production {
         cluster=true
         rank=same
         label="Production"
         penwidth=0.5
         typeset [label="Typesetting" shape="folder" width=1]
         edit [label="Editing" shape="folder" width=1]
         write [label="Writing" shape="folder" width=1]
         write -> edit -> typeset [constraint=false]
      }

       subgraph publication {
          cluster=true
          rank=same
          label="Publication"
          penwidth=0.5   
          www [label="Website" shape="note" width=1]
          ebook [label="eBook\nePub / PDF" shape="note" width=1]
          office [label="Office\ndocument" shape="note" width=1]
      }

      blogs -> notes [ltail=inspiration lhead=ideation]
      notes -> edit [ltail=ideation lhead=production]
      edit -> ebook [ltail=production lhead=publication]
      notes -> tasks [constraint=false ltail=ideation lhead=manage]
  }  
#+end_src
#+caption: Emacs Writing Studio workflow.
#+name: fig:workflow
#+attr_html: :width 600 :alt Emacs Writing Studio workflow :title Emacs Writing Studio workflow
#+attr_latex: :width 0.8\textwidth
#+attr_org: :width 100
#+RESULTS:
[[file:images/emacs-workflow.png]]

The basic principle of this workflow is that the author collects information from literature, the web, movies, and so on (/inspiration/), which they process in a note-taking system. These notes are the central repository of information and are linked to a bibliography (/ideation/). These ideas and notes form the foundation of the writing process (/production/). When the work is completed, the author publishes it in its final format (/publication/). However, there is a fifth step. At the end of a long day of writing and editing, we must also do some /Administration/ to keep our systems in good shape.

** Inspiration
Ideas don't pop into minds out of thin air. Our thoughts, plans, and inspirations derive from our lived experiences and what we read, hear, or watch. Emacs has extensive facilities to read any plain text format imaginable and display PDF files, ebooks and images. Listening to a podcast or watching a video is impossible within Emacs, but it can provide an interface to integrate with multimedia applications. You can also maintain a bibliography to organise and access your collection of electronic literature. Emacs can also browse the internet, although the built-in browser is not fully featured but a tool that displays websites as plain text. Chapter [[#chap:inspiration]] discusses how to read ebooks, surf the internet, and consume multimedia files with Emacs.

** Ideation
Ingesting all these new ideas is only worthwhile if you keep a record of your new-found inspirations. Hence, maintaining notes is essential to facilitate the ideation process. Emacs is an ideal tool for storing notes in plain text. Several packages are available to manage your digital brain. This step in the EWS workflow revolves around the Denote package by Protesilaos (Prot) Stavrou.

You don't need to follow any specific note taking methods such as /Zettelklasten/ or /Bullet Journal/. My personal collection of notes is a primordial soup of ideas, categorised using organically grown tags and opportunistically linked. Besides digital musings, you can add anything worth keeping to Denote, including binary files such as PDFs or photographs. Chapter [[#chap:ideation]] discusses how to use Org mode and the Denote package to develop a personal knowledge management system.

** Production
Once you have gathered your thoughts, it is time to start writing. Org mode is ideal for writing articles and books or developing websites. Emacs developers have also published many additional utilities to assist with the writing process, such as completion, grammar checking, a dictionary, thesaurus, and other indispensable tools. During production you also might want to collaborate with other authors, which requires some control over different versions. Chapter [[#chap:production]] describes how to use Org mode to write articles, websites and books and manage large projects.

** Publication
The glorious moment has arrived when you can publish the fruits of your labour. Emacs Org mode has powerful capabilities to export the text to various formats, most importantly word processor documents for sharing, PDF files for physical books, ePub for ebooks and HTML for websites. Org mode exports files to print-ready PDF files through the LaTeX document preparation system, which is popular with technical authors and publishers, but can be used for any type of physical book. Chapter [[#chap:publication]] discusses how to use Org mode to convert your plain text document to an electronic or physical publication to share with the world.

** Administration
Working through a writing project is a fantastic journey of creative expression, but there is also some overhead in managing your projects. Emacs interfaces with other GNU software to help you manage your files using the powerful directory editor (Dired). You can also use Emacs to manage your photographs and images with the built-in Image-Dired package. Lastly, working on a big project means tracking many tasks. Org mode has a fully functional task management system to help you keep track of your projects. You can implement your personal workflow or use a Getting Things Done (GTD) approach. Chapter [[#chap:admin]] discusses how to manage your files and your projects to keep you own track in your writing projects.
